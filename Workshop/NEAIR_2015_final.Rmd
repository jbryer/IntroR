---
title: "NEAIR Workshop"
author: "Jason Bryer, Ph.D."
date: "November 1, 2015"
output: html_document
---

This R markdown file is used to teach R for Institutional Researchers.

```{r setup, echo=FALSE, warning=FALSE, message=FALSE, results='hide'}
# This R chunk will be used to prepare the data for analysis. Typically, we will
# want to hide the R code and output in the final document.

# Load the packages we will use
library(ggplot2)
library(psych)
library(readxl)
library(knitr)

# Load data
students <- read_excel('Students.xls', sheet=1)
str(students)

# Convert Military variable to logical
students$Military <- students$Military == 'Y'

# Convert Enrolled variable to a Date
students$Enrolled <- as.Date(students$Enrolled)
```

There are `r nrow(students)` in the `students` data set.

## Descriptive Statistics

The following tables summarizes the number of credits students have by Division.

```{r credits, echo=TRUE, results='asis'}
tab.credits <- describeBy(students$Credits, group=students$Division, mat=TRUE)
tab.credits <- tab.credits[,c('group1','n','mean','sd','median')]
names(tab.credits) <- c('Division','n','Mean','Standard Deviation','Median')
kable(tab.credits, row.names=FALSE, caption='Credits by Division', digits=2)
```

## Number of Military Students by Division

```{r militaryTable, echo=TRUE}
tab.military <- table(students$Military, students$Division)
# Print table as counts
kable(tab.military)
# Print table as proportion within division
kable(prop.table(tab.military, 2) * 100, digits=2)
```

#### Barplot of military students by division

```{r militaryBarplot, echo=TRUE}
# Hint: use position='dodge' to create side-by-side bars
ggplot(students, aes(x=Division, fill=Military)) +
	geom_bar(position='dodge') +
	ylab('Number of Students') +
	ggtitle('Number of Military and Civilian Students by Division')
```

## Distribution of Credits

```{r histogram, echo=TRUE}
# Use histogram
ggplot(students, aes(x=Credits)) + 
	geom_histogram(binwidth=3) +
	ylab('Number of Students') +
	ggtitle('Histogram of Credits Earned')
```

## Distribution of Time Enrolled by Division

```{r enrolled, echo=TRUE}
# Use boxplots
students$TimeEnrolled <- as.integer(Sys.Date() - students$Enrolled)
ggplot(students, aes(x=Division, y=TimeEnrolled)) +
	geom_boxplot()
```

## Is there a difference in the number of credits by military and civilian students?

```{r miltaryCredits, echo=TRUE}
# What to do about NA credits? In this case missing credits mean 0
missingRows <- is.na(students$Credits)
students[missingRows,]$Credits <- 0
# t-test maybe?
t.results <- t.test(Credits ~ Military, data=students)
ls(t.results)
t.results$p.value

# Create a function to print the results of p-value as p < 0.001, p < 0.01, p < 0.05 or p > 0.05
print.p.value <- function(pvalue) {
	if(pvalue < 0.001) { 
		return('p < 0.001')
	} else if(pvalue < 0.01) {
		return('p < 0.01')
	} else if(pvalue < 0.05) {
		return('p < 0.05')
	} else {
		return('p >= 0.05')
	}
}
```

The difference between military and civilian credits is `r unname(diff(t.results$estimate))` which is `r ifelse(t.results$p.value > 0.5, 'not','')` statistically significant with `r print.p.value(t.results$p.value)`

